name: Monitor Orders (6h)

on:
  workflow_dispatch:

jobs:
  monitor:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: Ejecutar monitoreo por 6 horas
        shell: powershell
        run: |
          $cookie = "wmsession=d274004c-b7d6-4342-883c-fbffc49bf6ee-1764190660765"
          $urlBase = "https://www.revoolico.com/actions/topup-cubarecarga/in-transit-topup/"
          $orden = 6820980

          $endTime = (Get-Date).AddHours(6)

          Write-Host "Iniciando monitoreo hasta $endTime"

          while ((Get-Date) -lt $endTime) {
              $result = curl.exe `
                -H "Cookie: $cookie" `
                -H "User-Agent: Mozilla/5.0" `
                -H "Referer: https://www.revoolico.com/" `
                -L `
                "$urlBase$orden" 2>$null
          
              if ($result -match "transaccion" -and $result -match "status") {
                  $orden++
                  Write-Host "Nueva orden detectada: $orden"
              }
          
              Start-Sleep -Seconds 5
          }


          Write-Host "Tiempo m√°ximo alcanzado. Finalizando workflow."
